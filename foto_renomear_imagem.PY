import pandas as pd
import os

# ğŸ—‚ï¸ Caminhos personalizados
CAMINHO_EXCEL = r'C:\Users\SAM\Desktop\FOTOS.xlsx'
PASTA_IMAGENS = r'C:\Users\SAM\Desktop\IMAGEM'

# ğŸ” Leitura do Excel
try:
    df = pd.read_excel(CAMINHO_EXCEL)
except Exception as e:
    print(f'âŒ Erro ao ler o Excel:\n{e}')
    exit()

# ğŸ”¡ Normaliza os nomes das colunas
df.columns = df.columns.str.strip().str.lower()

# âœ… Verifica existÃªncia da coluna 'foto'
if 'foto' not in df.columns:
    print('âŒ Coluna "foto" nÃ£o encontrada na planilha.')
    print(f'ğŸ” Colunas detectadas: {df.columns.tolist()}')
    exit()

print('\nğŸš€ Iniciando renomeaÃ§Ã£o das imagens...\n')

# ğŸ“„ Logs
renomeados = []
nao_encontrados = []
conflitos = []
ignorados = []

# ğŸ” RenomeaÃ§Ã£o com tratamento de nulos e proteÃ§Ã£o contra sobrescrita
for nome_desejado in df['foto']:
    # ğŸ§  Ignora valores vazios ou invÃ¡lidos
    if pd.isna(nome_desejado):
        ignorados.append('Valor vazio ou invÃ¡lido')
        print('âš ï¸ Valor vazio na coluna "foto" â€” ignorado')
        continue

    # Converte para string com seguranÃ§a
    nome_desejado = str(nome_desejado).strip()
    nome_base = os.path.splitext(nome_desejado)[0]
    extensao = os.path.splitext(nome_desejado)[1]

    nome_antigo = os.path.join(PASTA_IMAGENS, f"{nome_base}_FOTO{extensao}")
    nome_novo = os.path.join(PASTA_IMAGENS, nome_desejado)

    if os.path.exists(nome_antigo):
        if not os.path.exists(nome_novo):
            os.rename(nome_antigo, nome_novo)
            renomeados.append(nome_desejado)
            print(f'âœ… {os.path.basename(nome_antigo)} â†’ {os.path.basename(nome_novo)}')
        else:
            conflitos.append(nome_desejado)
            print(f'âš ï¸ Arquivo destino jÃ¡ existe: {os.path.basename(nome_novo)} â€” ignorado')
    else:
        nao_encontrados.append(f"{nome_base}_FOTO{extensao}")
        print(f'âš ï¸ Arquivo nÃ£o encontrado: {os.path.basename(nome_antigo)}')

# ğŸ RelatÃ³rio final
print('\nğŸ“‹ RelatÃ³rio:')
print(f'âœ… Renomeados: {len(renomeados)}')
print(f'âš ï¸ NÃ£o encontrados: {len(nao_encontrados)}')
print(f'ğŸš« Conflitos (jÃ¡ existiam): {len(conflitos)}')
print(f'ğŸ•³ï¸ Ignorados por valor nulo/invÃ¡lido: {len(ignorados)}')
s
