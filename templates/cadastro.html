<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Cadastro de Usuário</title>
  <style>
    body {
      background-color: #f7d3ff;
      font-family: Arial, sans-serif;
      text-align: center;
      padding-top: 40px;
    }
    input {
      width: 300px;
      padding: 10px;
      margin: 12px;
      border: 1px solid #999;
      border-radius: 8px;
      font-size: 16px;
    }
    button {
      width: 320px;
      padding: 12px;
      border: none;
      border-radius: 8px;
      background-color: #c600ff;
      color: white;
      font-weight: bold;
      cursor: pointer;
      font-size: 16px;
    }
    button:hover {
      background-color: #9400cc;
    }
    .container {
      background-color: #fff0fe;
      border-radius: 12px;
      padding: 30px;
      display: inline-block;
      box-shadow: 0 0 10px #aaa;
    }
    h2 {
      margin-bottom: 25px;
    }
    .mensagem-erro {
      color: red;
      font-size: 14px;
      margin-top: -8px;
      margin-bottom: 8px;
      height: 18px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>Cadastro de Acesso</h2>
    <form method="POST">
      <input type="text" name="username" id="username"
       maxlength="11" required
       placeholder="nome de usuário"
       oninput="this.value = this.value.replace(/\s/g, '')"
       onblur="verificarDisponibilidade()"><br>
<div id="mensagem-usuario" class="mensagem-erro"></div>

      <input type="password" name="password" placeholder="senha" required><br>
      <input type="password" name="confirmar" placeholder="confirme a senha" required><br>
      <button type="submit" id="botao-cadastro">criar acesso</button>
    </form>
    <br>
    <form action="/">
      <button type="submit" style="background-color:#ccc; color:black;">voltar ao login</button>
    </form>
  </div>
<script>
function verificarDisponibilidade() {
  const nome = document.getElementById('username').value;
  const botao = document.getElementById('botao-cadastro');
  const span = document.getElementById('mensagem-usuario');

  if (nome.length === 0) {
    span.textContent = '';
    botao.disabled = false;
    return;
  }

  fetch(`/verificar_usuario?nome=${encodeURIComponent(nome)}&fmt=json`)
    .then(response => response.json())
    .then(data => {
      if (data.status === 'existente') {
        span.textContent = '❌ Usuário não está disponível.';
        botao.disabled = true;
      } else {
        span.textContent = '';
        botao.disabled = false;
      }
    })
    .catch(error => {
      console.error('Erro ao verificar nome:', error);
      botao.disabled = false;
    });
}
</script>
</body>
</html>
