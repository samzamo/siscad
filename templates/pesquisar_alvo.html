<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Pesquisar Alvo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    * { box-sizing: border-box; }

    body {
      background-color: #d2f5d0;
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
    }

    .form-wrapper {
      display: flex;
      justify-content: center;
      padding: 20px;
    }

    .form-container {
      width: 100%;
      max-width: 700px;
      background-color: #fff;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 0 10px #aaa;
    }

    h2, h3 {
      text-align: center;
      margin-top: 0;
    }

    input, textarea, select {
      width: 100%;
      padding: 10px;
      margin: 10px 0;
      border-radius: 8px;
      border: 1px solid #aaa;
      font-size: 16px;
    }

    button {
      background-color: #0d8df7;
      color: white;
      font-weight: bold;
      cursor: pointer;
      border: none;
      border-radius: 8px;
      padding: 10px;
      font-size: 16px;
    }

    button:hover {
      background-color: #0092cc;
    }

    .resultado-button {
      background-color: #f08c00;
      color: white;
      font-weight: bold;
      border: none;
      border-radius: 8px;
      padding: 10px;
      font-size: 15px;
      cursor: pointer;
      transition: background-color 0.3s;
      margin-bottom: 10px;
    }

    .resultado-button:hover {
      background-color: #cc7200;
    }

    .resultado, .alvo-info {
      margin-top: 30px;
      padding: 20px;
      background-color: #b4ebb4;
      border-radius: 10px;
      box-shadow: 0 0 10px #888;
    }

    .alvo-info-flex {
      display: flex;
      gap: 20px;
      justify-content: center;
      flex-wrap: wrap;
    }

    .alvo-info img {
      max-width: 220px;
      height: auto;
      max-height: 350px;
      object-fit: contain;
      border-radius: 12px;
      border: 2px solid #064d26;
      flex-shrink: 0;
    }
.alvo-info img:hover {
  transform: scale(2.0);
  z-index: 10;
}
    .alvo-dados {
      flex: 1;
      min-width: 240px;
      max-width: 100%;
    }

    .alvo-dados p {
      margin: 8px 0;
    }

    .anotacoes-box {
      white-space: pre-wrap;
      background-color: #fff;
      padding: 15px;
      border-radius: 10px;
      border: 1px solid #ccc;
      max-height: 300px;
      overflow-y: auto;
      margin-top: 20px;
    }

    @media screen and (max-width: 600px) {
      .alvo-info-flex { flex-direction: column; align-items: center; }
    }

    .centered {
      text-align: center;
    }

    .modal-overlay {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.6);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 999;
    }

    .modal-box {
      background: #fff;
      padding: 30px;
      border-radius: 12px;
      max-width: 600px;
      width: 90%;
      max-height: 95vh;
      overflow-y: auto;
      box-shadow: 0 0 12px #000;
      position: relative;
    }

    .modal-box h3 {
      margin-top: 0;
      text-align: center;
    }

    .close-button {
      background-color: #ff4c4c;
      color: white;
      font-weight: bold;
      border: none;
      padding: 8px 14px;
      border-radius: 6px;
      cursor: pointer;
      float: right;
      margin-top: -10px;
      margin-right: -10px;
    }

    .close-button:hover {
      background-color: #cc0000;
    }
  </style>
  <script>
    function abrirModal() {
      document.getElementById("modal-edicao").style.display = "flex";
    }
    function fecharModal() {
      document.getElementById("modal-edicao").style.display = "none";
    }
  </script>
</head>
<body>

  <div class="form-wrapper">
    <div class="form-container">

      <h2>Pesquisar Alvo</h2>
      
      {% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    {% for category, msg in messages %}
      <div id="msg-flash" style="
        position: fixed;
        top: 50%; left: 50%;
        transform: translate(-50%, -50%);
        background-color: #d4edda;
        color: #155724;
        font-weight: bold;
        padding: 16px 28px;
        border-radius: 12px;
        box-shadow: 0 0 10px rgba(0,0,0,0.25);
        border: 1px solid #c3e6cb;
        z-index: 9999;">
        {{ msg }}
      </div>
      <script>
        setTimeout(() => {
          const el = document.getElementById('msg-flash');
          if (el) el.style.display = 'none';
        }, 3000); // some em 3 segundos
      </script>
    {% endfor %}
  {% endif %}
{% endwith %}
      <form method="POST" style="margin-bottom: 15px;">
        <input type="text" name="termo" placeholder="nome ou vulgo" value="{{ termo }}" required>
        <input type="text" name="bairro" placeholder="bairro (opcional)" value="{{ bairro }}">
        <button type="submit">üîç pesquisar</button>
      </form>

      <form action="/menu">
        <button type="submit">üè† voltar ao menu</button>
      </form>

      {% if mensagem %}
        <p style="text-align:center; font-weight:bold; color:#a94442; background-color:#f2dede; padding:10px; border-radius:8px;">
          {{ mensagem }}
        </p>
      {% endif %}

      {% if resultados %}
        <div class="resultado">
          <h3>Resultados:</h3>
          {% for r in resultados %}
            <form method="GET">
              <input type="hidden" name="id" value="{{ r.id }}">
              <button type="submit" class="resultado-button">{{ r.nome }} ‚Äì {{ r.vulgo }}</button>
            </form>
          {% endfor %}
        </div>
      {% endif %}

      {% if alvo %}
        <div class="alvo-info">
          <h3>Alvo Selecionado</h3>
          <div class="alvo-info-flex">
            {% if alvo.foto %}
              <img src="{{ alvo.foto if alvo.foto.startswith('http') else url_for('static', filename='IMAGEM/' + alvo.foto) }}" alt="Foto do alvo">
            {% endif %}

            <div class="alvo-dados">
              <p><strong>Nome:</strong> {{ alvo.nome }}</p>
              <p><strong>Vulgo:</strong> {{ alvo.vulgo }}</p>
              <p><strong>Genitora:</strong> {{ alvo.genitora }}</p>
              <p><strong>Fac√ß√£o:</strong> {{ alvo.faccao }}</p>
              <p><strong>Munic√≠pio:</strong> {{ alvo.municipio }}</p>
              <p><strong>Bairro:</strong> {{ alvo.bairro }}</p>
              <p><strong>Endere√ßo:</strong> {{ alvo.octopus }}</p>
  {% if alvo.octopusasint == "SIM" %} 
  <p style="color: green; font-weight: bold;">
    ü¶â <strong>Octopus Asint:</strong> SIM
  </p>
{% elif alvo.octopusasint == "NAO" %}
  <p style="color: red; font-weight: bold;">
    ‚ùå <strong>Octopus Asint:</strong> NAO
  </p>
{% else %}
  <p><strong>Octopus Asint:</strong> {{ alvo.octopusasint }}</p>
{% endif %}
              <button type="button" onclick="abrirModal()">‚úèÔ∏è Alterar dados</button>

              {% if is_admin %}
                <form method="POST" action="/excluir_alvo" onsubmit="return confirm('Tem certeza que deseja excluir este alvo?')">
                  <input type="hidden" name="id" value="{{ alvo.id }}">
                  <button type="submit" style="background-color:#ff4c4c;">üóëÔ∏è excluir cadastro</button>
                </form>
              {% endif %}
            </div>
          </div>

          <div class="centered" style="margin-top: 20px;">
            <h4>Anota√ß√µes:</h4>
            <div class="anotacoes-box">{{ alvo.anotacoes }}</div>
          </div>
        </div>
      {% endif %}

    </div>
  </div>

  <!-- ü™ü MODAL DE EDI√á√ÉO FLUTUANTE UNIFICADO -->
<div id="modal-edicao" class="modal-overlay">
  <div class="modal-box">
    <button type="button" class="close-button" onclick="fecharModal()">‚ùå fechar</button>
    <h3>Editar Dados do Alvo</h3>

    {% if alvo.foto %}
    <div style="text-align:center; margin-bottom:20px;">
      <img src="{{ alvo.foto if alvo.foto.startswith('http') else url_for('static', filename='IMAGEM/' + alvo.foto) }}"
           alt="Foto atual"
           style="max-width:180px; max-height:250px; border-radius:10px; border:2px solid #0e93ec;">
      <p style="margin-top:8px; font-weight:bold;">Foto atual</p>
    </div>
    {% endif %}

    <form method="POST" enctype="multipart/form-data" action="/editar_alvo">
      <input type="hidden" name="id" value="{{ alvo.id }}">
      <input type="text" name="nome" value="{{ alvo.nome }}" placeholder="nome">
      <input type="text" name="vulgo" value="{{ alvo.vulgo }}" placeholder="vulgo">
      <input type="text" name="genitora" value="{{ alvo.genitora }}" placeholder="genitora">

      <select name="faccao" required>
        <option value="">Selecione a fac√ß√£o</option>
        {% for fac in ["CV", "PCC", "GDE", "MASSA", "TCP", "ADA", "SEM"] %}
        <option value="{{ fac }}" {% if alvo.faccao == fac %}selected{% endif %}>{{ fac }}</option>
        {% endfor %}
      </select>

      <!-- Munic√≠pio e Bairro din√¢micos -->
      <label for="municipio">Munic√≠pio:</label>
      <select name="municipio" id="municipio" onchange="atualizarBairros()" required>
        <option value="">Selecione</option>
        <option value="FORTALEZA" {% if alvo.municipio == "FORTALEZA" %}selected{% endif %}>FORTALEZA</option>
        <option value="CAUCAIA" {% if alvo.municipio == "CAUCAIA" %}selected{% endif %}>CAUCAIA</option>
        <option value="MARACANA√ö" {% if alvo.municipio == "MARACANA√ö" %}selected{% endif %}>MARACANA√ö</option>
      </select>

      <label for="bairro">Bairro:</label>
      <select name="bairro" id="bairro" required>
        <option value="{{ alvo.bairro }}">{{ alvo.bairro }}</option>
      </select>

      <textarea name="anotacoes" rows="10" placeholder="anota√ß√µes">[{{ now }}] 
‚§µÔ∏è Digite abaixo a nova anota√ß√£o...

{{ alvo.anotacoes }}</textarea>

      <input type="text" name="octopus" value="{{ alvo.octopus }}" placeholder="endere√ßo">

      <select name="octopusasint" required>
        <option value="" {% if alvo.octopusasint == "" %}selected{% endif %}>--octopus--</option>     
        <option value="NAO" {% if alvo.octopusasint == "N√£o" %}selected{% endif %}>NAO</option>
        <option value="SIM" {% if alvo.octopusasint == "Sim" %}selected{% endif %}>SIM</option>
      </select>

      <input type="file" name="nova_foto" accept="image/*">
      <button type="submit">üíæ salvar altera√ß√µes</button>
    </form>
  </div>
</div>

<!-- Script para abrir o modal automaticamente -->
{% if alvo and request.args.get('open_modal') %}
<script>
  const abrirModalAutomaticamente = "{{ 'true' if alvo and request.args.get('open_modal') else 'false' }}";

  document.addEventListener('DOMContentLoaded', function () {
    if (abrirModalAutomaticamente === "true") {
      abrirModal();
      atualizarBairros();
    }
  });
</script>
{% endif %}

<!-- Script para atualizar bairros dinamicamente -->
<script>
  const bairrosPorMunicipio = {
    "FORTALEZA": ["Aerol√¢ndia", "Aeroporto", "Aldeota", "Alto Alegre", "Alto da Balan√ßa", "√Ålvaro Weyne",
        "Amadeu Furtado", "Ancuri", "Ant√¥nio Bezerra", "Ant√¥nio Diogo", "Autran Nunes",
        "Barra do Cear√°", "Barroso", "Bela Vista", "Benfica", "Boa Vista", "Bom Futuro",
        "Bom Jardim", "Bonsucesso", "Cachoeirinha", "Cais do Porto", "Cajazeiras", "Cambeba",
        "Canindezinho", "Carlito Pamplona", "Centro", "Cidade 2000", "Cidade dos Funcion√°rios",
        "Coa√ßu", "Coc√≥", "Conjunto Cear√°", "Conjunto Esperan√ßa", "Conjunto Palmeiras",
        "Couto Fernandes", "Cristo Redentor", "Curi√≥", "Damas", "De Lourdes", "Dem√≥crito Rocha",
        "Dend√™", "Dias Macedo", "Dion√≠sio Torres", "Dom Lustosa", "Edson Queiroz",
        "Engenheiro Luciano Cavalcante", "Farias Brito", "F√°tima", "Floresta", "Granja Lisboa",
        "Granja Portugal", "Guajiru", "Henrique Jorge", "Itaoca", "Itaperi", "Jacarecanga",
        "Jangurussu", "Jardim Am√©rica", "Jardim Cearense", "Jardim das Oliveiras", "Jardim Guanabara",
        "Jardim Iracema", "Jo√£o XXIII", "Joaquim T√°vora", "J√≥quei Clube", "Jos√© Bonif√°cio",
        "Jos√© de Alencar", "Lagoa Redonda", "Manoel Dias Branco", "Manuel S√°tiro", "Maraponga",
        "Meireles", "Messejana", "Mondubim", "Monte Castelo", "Montese", "Moura Brasil",
        "Mucuripe", "Novo Mondubim", "Olavo Oliveira", "Padre Andrade", "Pan Americano",
        "Papicu", "Parangaba", "Parque Arax√°", "Parque Dois Irm√£os", "Parque Geniba√∫",
        "Parque Iracema", "Parque Manibura", "Parque Presidente Vargas", "Parque Santa Maria",
        "Parque Santa Rosa", "Parque S√£o Jos√©", "Parquel√¢ndia", "Parre√£o", "Passar√©",
        "Patriolino Ribeiro", "Paupina", "Pedras", "Pici", "Pirambu", "Planalto Ayrton Senna",
        "Praia de Iracema", "Prefeito Jos√© Walter", "Presidente Kennedy", "Quintino Cunha",
        "Rodolfo Te√≥filo", "Sabiaguaba", "Salinas", "S√£o Bento", "S√£o Gerardo",
        "S√£o Jo√£o do Tauape", "Sapiranga", "Serrinha", "Siqueira", "Varjota", "Vicente Pinzon",
        "Vila Ellery", "Vila Peri", "Vila Uni√£o", "Vila Velha"],
    "CAUCAIA": ["JUREMA", "TABAPU√Å", "PARQUE SOLEDADE"],
    "MARACANA√ö": ["JARDIM JATOB√Å", "PAJU√áARA", "CENTRO"]
  };

  function atualizarBairros() {
    const municipio = document.getElementById("municipio").value;
    const bairroSelect = document.getElementById("bairro");
    bairroSelect.innerHTML = "";

    if (municipio && bairrosPorMunicipio[municipio]) {
      bairrosPorMunicipio[municipio].forEach(bairro => {
        const option = document.createElement("option");
        option.value = bairro;
        option.textContent = bairro;
        bairroSelect.appendChild(option);
      });
    } else {
      const option = document.createElement("option");
      option.textContent = "Selecione um munic√≠pio primeiro";
      bairroSelect.appendChild(option);
    }
  }
</script>


</body>
</html>
