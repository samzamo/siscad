<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Cadastro de Alvo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    /* Estilos mantidos iguais */
    * { box-sizing: border-box; }
    body {
      background-color: #b6ffe7;
      font-family: Arial, sans-serif;
      margin: 0; padding: 0;
    }
    .form-wrapper {
      display: flex; justify-content: center;
      align-items: center; padding: 30px;
    }
    .form-container {
      background-color: #fcfcfc;
      padding: 30px;
      border-radius: 12px;
      max-width: 500px;
      width: 100%;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    h2, h3 { text-align: center; margin-top: 0; }
    input, select, textarea {
      width: 100%; padding: 10px;
      margin: 8px 0; border-radius: 8px;
      border: 1px solid #aaa;
      font-size: 16px;
    }
    button {
      width: 100%; padding: 12px;
      margin-top: 10px;
      border-radius: 8px; border: none;
      background-color: #0e93ec;
      color: white; font-weight: bold;
      font-size: 16px; cursor: pointer;
    }
    button:hover { background-color: #007dd2; }
    @media screen and (max-width: 600px) {
      .form-wrapper { padding: 20px; }
      .form-container { padding: 20px; }
      input, select, textarea, button { font-size: 14px; }
      h2, h3 { font-size: 18px; }
    }
  </style>

  <script>
    const bairrosPorMunicipio = {
      Fortaleza: [ "Aerol√¢ndia", "Aeroporto", "Aldeota", "Alto Alegre", "Alto da Balan√ßa", "√Ålvaro Weyne",
        "Amadeu Furtado", "Ancuri", "Ant√¥nio Bezerra", "Ant√¥nio Diogo", "Autran Nunes",
        "Barra do Cear√°", "Barroso", "Bela Vista", "Benfica", "Boa Vista", "Bom Futuro",
        "Bom Jardim", "Bonsucesso", "Cachoeirinha", "Cais do Porto", "Cajazeiras", "Cambeba",
        "Canindezinho", "Carlito Pamplona", "Centro", "Cidade 2000", "Cidade dos Funcion√°rios",
        "Coa√ßu", "Coc√≥", "Conjunto Cear√°", "Conjunto Esperan√ßa", "Conjunto Palmeiras",
        "Couto Fernandes", "Cristo Redentor", "Curi√≥", "Damas", "De Lourdes", "Dem√≥crito Rocha",
        "Dend√™", "Dias Macedo", "Dion√≠sio Torres", "Dom Lustosa", "Edson Queiroz",
        "Engenheiro Luciano Cavalcante", "Farias Brito", "F√°tima", "Floresta", "Granja Lisboa",
        "Granja Portugal", "Guajiru", "Henrique Jorge", "Itaoca", "Itaperi", "Jacarecanga",
        "Jangurussu", "Jardim Am√©rica", "Jardim Cearense", "Jardim das Oliveiras", "Jardim Guanabara",
        "Jardim Iracema", "Jo√£o XXIII", "Joaquim T√°vora", "J√≥quei Clube", "Jos√© Bonif√°cio",
        "Jos√© de Alencar", "Lagoa Redonda", "Manoel Dias Branco", "Manuel S√°tiro", "Maraponga",
        "Meireles", "Messejana", "Mondubim", "Monte Castelo", "Montese", "Moura Brasil",
        "Mucuripe", "Novo Mondubim", "Olavo Oliveira", "Padre Andrade", "Pan Americano",
        "Papicu", "Parangaba", "Parque Arax√°", "Parque Dois Irm√£os", "Parque Geniba√∫",
        "Parque Iracema", "Parque Manibura", "Parque Presidente Vargas", "Parque Santa Maria",
        "Parque Santa Rosa", "Parque S√£o Jos√©", "Parquel√¢ndia", "Parre√£o", "Passar√©",
        "Patriolino Ribeiro", "Paupina", "Pedras", "Pici", "Pirambu", "Planalto Ayrton Senna",
        "Praia de Iracema", "Prefeito Jos√© Walter", "Presidente Kennedy", "Quintino Cunha",
        "Rodolfo Te√≥filo", "Sabiaguaba", "Salinas", "S√£o Bento", "S√£o Gerardo",
        "S√£o Jo√£o do Tauape", "Sapiranga", "Serrinha", "Siqueira", "Varjota", "Vicente Pinzon",
        "Vila Ellery", "Vila Peri", "Vila Uni√£o", "Vila Velha"],
      Caucaia: ["Parque Soledade", "Jurema", "Centro", "Tabapu√°"],
      Maracana√∫: ["Paju√ßara", "Jardim Bandeirantes", "Centro", "Alto Alegre"]
    };

    function atualizarBairros() {
      const municipio = document.getElementById("municipio").value;
      const bairroSelect = document.getElementById("bairro");
      bairroSelect.innerHTML = "";
      if (bairrosPorMunicipio[municipio]) {
        bairrosPorMunicipio[municipio].forEach(b => {
          const opt = document.createElement("option");
          opt.value = b;
          opt.textContent = b;
          bairroSelect.appendChild(opt);
        });
      }
    }

    function verificarNome() {
      const inputNome = document.querySelector('input[name="nome"]');
      const aviso = document.getElementById("aviso-nome");
      const nome = inputNome.value.trim();

      if (!nome) {
        aviso.textContent = "";
        aviso.style.color = "#555";
        return;
      }

      aviso.textContent = "‚è≥ Verificando nome...";
      aviso.style.color = "#555";

      fetch(`/verificar_nome?fmt=json&nome=${encodeURIComponent(nome)}`)
        .then(res => res.json())
        .then(data => {
          if (data.status === "existente" && data.id) {
            aviso.textContent = "‚ö†Ô∏è Este nome j√° est√° cadastrado.";
            aviso.style.color = "#900";
            abrirModalConfirma(data.id, nome);
          } else {
            aviso.textContent = "‚úîÔ∏è Nome dispon√≠vel para cadastro.";
            aviso.style.color = "#080";
          }
        })
        .catch(() => {
          aviso.textContent = "‚ö†Ô∏è Erro ao verificar nome.";
          aviso.style.color = "#900";
        });
    }
  </script>
</head>
<body>
  <div class="form-wrapper">
    <div class="form-container">
      <h2>Cadastro de Alvo</h2>

      {% if mensagem %}
        <div style="background-color:#ffe0e0; color:#900; padding:10px; border-radius:8px; margin-bottom:15px;">
          {{ mensagem }}
        </div>
      {% endif %}

      <form method="POST" enctype="multipart/form-data">
        <input type="text" name="nome" placeholder="Nome" required onblur="verificarNome()">
        <div id="aviso-nome" style="margin-bottom:10px; font-weight:bold;"></div>

        <input type="text" name="vulgo" placeholder="Vulgo">
        <input type="text" name="genitora" placeholder="Genitora">
       <!-- ‚úÖ Novo campo Fac√ß√£o -->
<select name="faccao" required>
  <option value="">Selecione a fac√ß√£o</option>
  <option value="CV">CV</option>
  <option value="PCC">PCC</option>
  <option value="GDE">GDE</option>
  <option value="MASSA">MASSA</option>
  <option value="TCP">TCP</option>
  <option value="ADA">ADA</option>
  <option value="SEM">SEM</option>
</select>

        <select name="municipio" id="municipio" onchange="atualizarBairros()" required>
          <option value="">Selecione o munic√≠pio</option>
          <option value="Fortaleza">Fortaleza</option>
          <option value="Caucaia">Caucaia</option>
          <option value="Maracana√∫">Maracana√∫</option>
        </select>

        <select name="bairro" id="bairro" required>
          <option value="">Selecione o bairro</option>
        </select>

        <textarea name="anotacoes" placeholder="Anota√ß√µes sobre o alvo" rows="4"></textarea>
        <input type="text" name="octopus" placeholder="Endere√ßo">
        <select name="octopusasint" required> # octopus sim ou n√£o
         
  <option value="NAO">NAO</option>
  <option value="SIM">SIM</option>
  
</select>
        <input type="file" name="foto" accept="image/*">

        <button type="submit">Salvar</button>
      </form>

      <form action="/menu">
        <button type="submit" style="background-color: #ccc; color: #000;">Voltar ao Menu</button>
      </form>
    </div>
  </div>

  <h3 style="text-align:center">Total de alvos cadastrados: {{ total }}</h3>

  <!-- üîç Modal de confirma√ß√£o quando nome j√° existe -->
  <div id="modal-confirma" style="
    position: fixed; inset: 0;
    background: rgba(0,0,0,0.6);
    display: none; align-items: center; justify-content: center;
    z-index: 9999;
  ">
    <div style="
      background: #fff; padding: 24px; border-radius: 12px;
      width: 95%; max-width: 420px; text-align: center;
      box-shadow: 0 2px 10px rgba(0,0,0,0.25);
    ">
      <h3 style="margin-top:0;">Pessoa j√° cadastrada</h3>
      <p style="margin: 8px 0 20px;">pessoa j√° cadastrada, deseja atualizar os dados?</p>

      <div style="display:flex; gap:12px; justify-content:center;">
        <button id="btn-confirma-sim" style="padding:10px 16px; border:none; border-radius:8px; background:#0e93ec; color:#fff; font-weight:bold; cursor:pointer;">
          sim
        </button>
        <button id="btn-confirma-nao" style="padding:10px 16px; border:none; border-radius:8px; background:#ccc; color:#000; font-weight:bold; cursor:pointer;">
          n√£o
        </button>
      </div>
    </div>
  </div>

  <!-- Scripts para controle do modal -->
  <script>
    let idExistente = null;

    function abrirModalConfirma(id, nome) {
      idExistente = id;
      document.getElementById('modal-confirma').style.display = 'flex';
    }

    function fecharModalConfirma() {
      document.getElementById('modal-confirma').style.display = 'none';
      idExistente = null;
    }

    document.getElementById('btn-confirma-sim').addEventListener('click', function () {
      if (!idExistente) return;
      window.location.href = `/pesquisar_alvo?id=${encodeURIComponent(idExistente)}&open_modal=1`;
    });

    document.getElementById('btn-confirma-nao').addEventListener('click', function () {
      fecharModalConfirma();
    });
  </script>
</body>
</html>
